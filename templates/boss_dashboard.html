<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Boss Dashboard</title>
    <style>
        .menu-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .menu-item img {
            width: 100px;
            height: auto;
            margin-right: 10px;
        }
        .notice-item {
            margin-bottom: 10px;
        }
        .delete-btn {
            margin-left: 20px;
            padding: 5px 10px;
            background-color: #f00;
            color: #fff;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Welcome to Boss Dashboard</h1>
    <a href="/add_menu">메뉴 추가</a>
    <h2>메뉴 목록</h2>
    <div id="menuList">
        <!-- 메뉴 목록이 여기에 동적으로 추가될 것입니다 -->
    </div>
    <p></p>
    <a href="/add_notice">공지사항 추가</a>
    <h2>공지사항 목록</h2>
    <ul id="noticeList">
        <!-- 공지사항 목록이 여기에 동적으로 추가될 것입니다 -->
    </ul>

    <p>--------------------------------  </p>
    <a href="/logout">로그아웃</a>

    <script>

        const currentUserId = {{ session['user_id'] }};

        // 서버에서 메뉴 데이터를 가져와서 동적으로 메뉴 목록을 생성합니다.
        fetch('/get_menu')
            .then(response => response.json())
            .then(data => {
                const menuList = document.getElementById('menuList');
                data.forEach(menu => {
                    const menuItem = document.createElement('div');
                    menuItem.classList.add('menu-item');

                    // 메뉴 이미지
                    const img = document.createElement('img');
                    img.src = "" + menu.image_url;
                    menuItem.appendChild(img);

                    // 메뉴 이름
                    const name = document.createElement('span');
                    name.textContent = menu.name;
                    menuItem.appendChild(name);

                    // 메뉴 삭제 버튼
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = '메뉴 삭제';
                    deleteBtn.classList.add('delete-btn');
                    deleteBtn.addEventListener('click', () => deleteMenu(menu.menu_id));
                    menuItem.appendChild(deleteBtn);

                    menuList.appendChild(menuItem);
                });
            });

        // 메뉴 삭제 함수
        function deleteMenu(menuId) {
            fetch(`/delete_menu/${menuId}`, { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        // 성공적으로 삭제되면 페이지 새로고침
                        location.reload();
                    } else {
                        alert('메뉴 삭제에 실패했습니다.');
                    }
                });
        }
        

        // 서버에서 공지사항 데이터를 가져와서 동적으로 공지사항 목록을 생성합니다.
        fetch('/get_notices')
            .then(response => response.json())
            .then(data => {
                const noticeList = document.getElementById('noticeList');
                data.forEach(notice => {
                    const noticeItem = document.createElement('li');
                    noticeItem.classList.add('notice-item');

                    // 작성자 유형 추가 (Enum 값)
                    const authorType = document.createElement('span');
                    authorType.textContent = notice.author_type;
                    noticeItem.appendChild(authorType);

                    // 띄어쓰기 추가
                    const space1 = document.createTextNode(' ');
                    noticeItem.appendChild(space1);

                    // 공지사항 내용
                    const content = document.createElement('span');
                    content.textContent = notice.content;
                    noticeItem.appendChild(content);

                    // 띄어쓰기 추가
                    const space2 = document.createTextNode(' ');
                    noticeItem.appendChild(space2);

                    // 생성 일시
                    const createdAt = document.createElement('span');
                    createdAt.textContent = notice.created_at;
                    noticeItem.appendChild(createdAt);

                    // 삭제 버튼, 현재 사용자가 작성자이면서 boss일 때만 표시
                    if (notice.author_type === 'boss' && currentUserId === notice.author_id) {
                        const deleteBtn = document.createElement('button');
                        deleteBtn.textContent = '삭제';
                        deleteBtn.classList.add('delete-btn');
                        deleteBtn.addEventListener('click', () => deleteNotice(notice.notice_id));
                        noticeItem.appendChild(deleteBtn);
                    }

                    noticeList.appendChild(noticeItem);
                });
            });

        // 공지사항 삭제 함수
        function deleteNotice(noticeId) {
            fetch(`/delete_notice/${noticeId}`, { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        // 성공적으로 삭제되면 페이지 새로고침
                        location.reload();
                    } else {
                        alert('Failed to delete notice.');
                    }
                });
        }
    </script>
</body>
</html>
